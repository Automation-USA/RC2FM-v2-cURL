# Name:
[New-SMS]-Send-SMS-()

Created by: Julio Toledo - Automation USA LLC

Purpose:
Tests sending an SMS message

Important Notes:
-Requires FileMaker 16+ native JSON functions
-This unit test requires FileMaker's native "While" function (FileMaker versions 18+)

# SMS message body
// Set Variable [ $originalText ; Value: RC2FM_GLOBALS::smsText ] 
Set Variable [ $originalText ; Value: "Hello world! This is my MMS test!" ] 
Set Variable [ $messageText ; Value: Substitute ( $originalText ; [Char ( "10" ); "\n" ]; [Char ( "13" ); "\n" ] ; [ Char ( "¶" ); "\n" ] ) ] 
# 
# SMS sender's phone number (e.g. *your* RingCentral phone number)
Set Variable [ $fromPhoneNum ; Value: $$MainCompanyNumber ] 
# 
// # Single SMS recipient (single destination phone number)
// Set Variable [ $toPhones ; Value: "+13055551212" ] 
# multiple SMS recipients (a group of destination phone numbers)
Set Variable [ $toPhones ; Value: List ( "+13055551212" ; "+17865551212"; "+19545551212" ) ] 
# 
# JSON encode parameter (requires native FileMaker "While" function [available in versions 18+].)
Set Variable [ 
	$param.json ; 
	Value: While ( 		
		//initialVariable(s) 		
		[
	 			fromNum = $fromPhoneNum ;
	 			numList = $toPhones; 			
	 			json = JSONSetElement ( 
						"{}" ; 
						[ "from" ; fromNum ; JSONString ]; 
						[ "text" ; $messagetext ; JSONString ] 
				) ;
	 			i = -1 
	 	] ;
	 	//condition
 		i < ValueCount ( numList ) -1 ;

		//logic
		[
			i = i + 1 ; //iterate from 0
			aNum = GetValue ( numList ; i+1 ) ;
			obj = JSONSetElement ( "{}" ; "phoneNumber" ; aNum ; JSONString );
			json = JSONSetElement ( json ; "to[" & i & "]" ; obj ; JSONObject )
		] ; 

		//result
		json
	)
# 
# call SMS API endpoint
Perform Script [ Specified: From list ; “[POST]__RingCentral-SMS-Send-(param.json)” ; Parameter: $param.json ]
Set Variable [ $result ; Value: Get (ScriptResult) ] 
